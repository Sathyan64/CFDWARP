#include <model/chem/_chem.h>
#include <model/_model.h>
#include <model/thermo/_thermo.h>
#include <model/metrics/_metrics.h>

#define nr 76

const static long mR[nr][ns]=
 {/*e-  O   O-  O+  O2  O2- O2+ O3  N   N+  N2  N2+ N2A NO  NO+  */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 1a */
   {1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 1b */
   {2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0},  /* 2Aa */
   {2,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0},  /* 2Ab */
   {2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1},  /* 2Ac */
   {2,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0},  /* 2Ad */
   {2,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 2Ae */
   {1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0},  /* 3a */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0},  /* 3b */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1},  /* 3c */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0},  /* 4Aa */
   {1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0},  /* 4Ab */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1},  /* 4Ac */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0},  /* 4Ad */
   {1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 4Ae */
   {1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0},  /* 4Af */
   {1,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0},  /* 4Ag */
   {1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1},  /* 4Ah */
   {1,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0},  /* 4Ai */
   {1,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 4Aj */
   {1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 5a */
   {1,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 5b */
   {1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 5c */
   {1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0},  /* 5d */
   {1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0},  /* 5e */
   {0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 6a */
   {0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 6b */
   {0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 6c */
   {0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 6d */
   {0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 7a */
   {0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 7b */
   {0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 7c */
   {0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0},  /* 7d */
   {0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0},  /* 8Aa */
   {0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Ab */
   {0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0},  /* 8Ac */
   {0,  0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Ad */
   {0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1},  /* 8Ae */
   {0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0},  /* 8Af */
   {0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Ag */
   {0,  0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0},  /* 8Ah */
   {0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Ai */
   {0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1},  /* 8Aj */
   {0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  1,  0,  0,  0},  /* 8Ba */
   {0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bb */
   {0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  1,  0,  0,  0,  0},  /* 8Bc */
   {0,  0,  0,  1,  0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bd */
   {0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  1},  /* 8Be */
   {0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0},  /* 8Bf */
   {0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bg */
   {0,  0,  1,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0},  /* 8Bh */
   {0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bi */
   {0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1},  /* 8Bj */
   {0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0},  /* 8Bk */
   {0,  0,  0,  0,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Bl */
   {0,  0,  0,  0,  1,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0},  /* 8Bm */
   {0,  0,  0,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Bn */
   {0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1},  /* 8Bo */
   {0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0},  /* 8Bp */
   {0,  0,  1,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Bq */
   {0,  0,  1,  0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0},  /* 8Br */
   {0,  0,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Bs */
   {0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1},  /* 8Bt */
   {0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0},  /* 9a */
   {0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0},  /* 9b */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 10a */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0},  /* 10b */
   {0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0},  /* 11a */
   {0,  1,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 11b */
   {0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 11c */
   {0,  1,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 11d */
   {0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  1,  0,  0,  0,  0},  /* 11Ea */
   {0,  0,  0,  0,  1,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0},  /* 11Eb */
   {0,  2,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 11f */
   {0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 11g */
   {0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 11h */
  /*e-  O   O-  O+  O2  O2- O2+ O3  N   N+  N2  N2+ N2A NO  NO+  */
 };

 
const static long mP[nr][ns]=
 {
  /*e-  O   O-  O+  O2  O2- O2+ O3  N   N+  N2  N2+ N2A NO  NO+  */
   {2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0},  /* 1a */
   {2,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0},  /* 1b */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 2Aa */
   {1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 2Ab */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0},  /* 2Ac */
   {1,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 2Ad */
   {1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 2Ae */
   {0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 3a */
   {0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0},  /* 3b */
   {0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 3c */
   {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0},  /* 4Aa */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 4Ab */
   {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0},  /* 4Ac */
   {0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0},  /* 4Ad */
   {0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 4Ae */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 4Af */
   {0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 4Ag */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0},  /* 4Ah */
   {0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 4Ai */
   {0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 4Aj */
   {0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 5a */
   {0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 5b */
   {0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 5c */
   {0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 5d */
   {0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 5e */
   {1,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 6a */
   {1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0},  /* 6b */
   {1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 6c */
   {1,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 6d */
   {1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 7a */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0},  /* 7b */
   {1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0},  /* 7c */
   {1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 7d */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Aa */
   {0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Ab */
   {0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 8Ac */
   {0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Ad */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0},  /* 8Ae */
   {0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Af */
   {0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Ag */
   {0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 8Ah */
   {0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Ai */
   {0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0},  /* 8Aj */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0},  /* 8Ba */
   {0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bb */
   {0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0},  /* 8Bc */
   {0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bd */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0},  /* 8Be */
   {0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0},  /* 8Bf */
   {0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bg */
   {0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0},  /* 8Bh */
   {0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bi */
   {0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0},  /* 8Bj */
   {0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bk */
   {0,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Bl */
   {0,  0,  0,  0,  2,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 8Bm */
   {0,  1,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Bn */
   {0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0},  /* 8Bo */
   {0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 8Bp */
   {0,  1,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Bq */
   {0,  1,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0},  /* 8Br */
   {0,  2,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 8Bs */
   {0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0},  /* 8Bt */
   {0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1},  /* 9a */
   {0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1},  /* 9b */
   {1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0},  /* 10a */
   {0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 10b */
   {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0},  /* 11a */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0},  /* 11b */
   {0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0,  0,  0,  0},  /* 11c */
   {0,  0,  0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0},  /* 11d */
   {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0},  /* 11Ea */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 11Eb */
   {0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  /* 11f */
   {0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0},  /* 11g */
   {0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0},  /* 11h */
  /*e-  O   O-  O+  O2  O2- O2+ O3  N   N+  N2  N2+ N2A NO  NO+  */
 };
  




void find_W(spec_t rhok, double T, double Te, double Tv, double Efieldstar, double Qbeam, spec_t W){
  long flux,spec,reaction,spec2,cnt;
  double kf[nr];
  spec_t nk,dnkdt;
  double vartheta,rho,qi;
  
  for (spec=0; spec<ns; spec++) W[spec]=0.0;

  /* find the gas temperature and the electron temperature */
  vartheta=Efieldstar/1.0e-20;

  /* set the reaction rates for each reaction */
  kf[0]=pow(10.0,-8.3-36.5/vartheta);  /* 1a */
  kf[1]=pow(10.0,-8.8-28.1/vartheta);  /* 1b */
  kf[2]=1e-19*pow(300.0/Te,4.5);       /* 2A */
  for (cnt=3; cnt<=6; cnt++) kf[cnt]=kf[2];
  kf[7]=2.0e-7*pow(300.0/Te,0.7); /* 3a */     
  kf[8]=2.8e-7*pow(300.0/Te,0.5); /* 3b */     
  kf[9]=4.0e-7*pow(300.0/Te,1.5); /* 3c */     
  kf[10]=6.0e-27*pow(300.0/Te,1.5); /* 4A */     
  for (cnt=11; cnt<=19; cnt++) kf[cnt]=kf[10];
  if (vartheta<8.0) {
    kf[20]=pow(10.0,-9.3-12.3/vartheta);
  } else {
    kf[20]=pow(10.0,-10.2-5.7/vartheta);
  }      /* 5a */
  kf[21]=1.4e-29*300.0/Te*exp(-600.0/T)*exp(700.0*(Te-T)/Te/T); /* 5b */
  kf[22]=1.07e-31*sqr(300.0/Te)*exp(-70.0/T)*exp(1500.0*(Te-T)/Te/T); /* 5c */
  kf[23]=1e-9;  /* 5d */
  kf[24]=1e-11; /* 5e */
  kf[25]=8.6e-10*exp(-6030.0/T)*(1.0-exp(-1570.0/T)); /* 6a */
  kf[26]=1.5e-10; /* 6b */
  kf[27]=1.9e-12*sqrt(T/300.0)*exp(-4990.0/T); /* 6c */
  kf[28]=2.7e-10*sqrt(T/300.0)*exp(-5590.0/T); /* 6d */
  kf[29]=5e-10; /* 7a */
  kf[30]=2.6e-10; /* 7b */
  kf[31]=5.0e-15; /* 7c */
  kf[32]=2.2e-9; /* 7d */
  kf[33]=2.0e-7*sqrt(300.0/T); /* 8A */
  for (cnt=34; cnt<=42; cnt++) kf[cnt]=kf[33]; /* 8A */
  kf[43]=2.0e-25*pow(300.0/T,2.5); /* 8B */
  for (cnt=44; cnt<=62; cnt++) kf[cnt]=kf[43]; /* 8B */
  kf[63]=1.2e-10; /* 9a */
  kf[64]=1.3e-10*sqrt(300.0/T); /* 9b */
  kf[65]=pow(10.0,-8.4-14.0/vartheta); /* 10a */
  kf[66]=2.54e-12; /* 10b */
  kf[67]=1.76e-31*pow(T,-0.5); /* 11a */
  kf[68]=kf[67]; /* 11b */
  kf[69]=6.2e-34*sqr(300.0/T); /* 11c */
  kf[70]=6.9e-34*pow(300.0/T,1.25); /* 11d */
  kf[71]=8.27e-34*exp(500.0/T); /* 11Ea */
  kf[72]=kf[71]; /* 11Eb */
  kf[73]=2.45e-31*pow(T,-0.63); /* 11f */
  kf[74]=2.76e-34*exp(720.0/T); /* 11g */
  if (T<300.0) {
    kf[75]=4.5e-12*exp(-3220.0/T); /* 11h */
  } else {
    kf[75]=1.1e-14*T*exp(-3150.0/T); /* 11h */
  }
  
      
  /* find the mole fraction Xk in moles/cm^3 */
  for (spec=0; spec<ns; spec++){
    nk[spec]=rhok[spec]/_calM(spec)*1e-6*calA;
  } 
  
  for (reaction=0; reaction<nr; reaction++){
    /* find dXkdt for reaction n */
    for (spec=0; spec<ns; spec++){
      dnkdt[spec]=((double)(mP[reaction][spec])-(double)(mR[reaction][spec]))*kf[reaction];
      for (spec2=0; spec2<ns; spec2++) {
        if (mR[reaction][spec2]==1) {
          dnkdt[spec]=dnkdt[spec]*nk[spec2];
        }
        if (mR[reaction][spec2]==2) {
          dnkdt[spec]=dnkdt[spec]*nk[spec2]*nk[spec2];
        }
        if (mR[reaction][spec2]==3) {
          dnkdt[spec]=dnkdt[spec]*nk[spec2]*nk[spec2]*nk[spec2];
        }
	
      }	
    }
    /* add dXkdt to W*/ 
    for (spec=0; spec<ns; spec++){
      W[spec]+=1.0e6*_calM(spec)*dnkdt[spec]/calA;
    }
  }

  /* ionization rates due to the electron beam */
  rho=0.0;
  for (spec=0; spec<ns; spec++) rho+=rhok[spec];
  qi=Qbeam/34.0/1.6022e-19;
  W[speceminus]+=qi*_calM(speceminus)/calA; /* eminus */
  W[specO2plus]+=rhok[specO2]/rho*qi*_calM(specO2plus)/calA;       /* O2plus */
  W[specN2plus]+=rhok[specN2]/rho*qi*_calM(specN2plus)/calA; /* N2plus */
}


void find_dW_dx(spec_t rhok, double T, double Te, double Tv, double Efieldstar, double Qbeam,
              spec2_t dWdrhok, spec_t dWdT, spec_t dWdTe, spec_t dWdTv, spec_t dWdEfieldstar,
	      spec_t dWdQbeam){
  long spec,spec2;
  for (spec=0; spec<ns; spec++){
    for (spec2=0; spec2<ns; spec2++) dWdrhok[spec][spec2]=0.0;
    dWdT[spec]=0.0;
    dWdTe[spec]=0.0;
    dWdTv[spec]=0.0;
    dWdEfieldstar[spec]=0.0;
    dWdQbeam[spec]=0.0;
  }	
}
